(self.webpackChunk=self.webpackChunk||[]).push([[202],{2202:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});a(1263),a(122);var o=a(629);function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,o)}return a}function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const s={name:"GroupNodesList",components:{"tree-item":{template:'<li>\n                <div\n                  v-if="!isBase"\n                  :class="{bold: isFolder}"\n                  @click="toggle"\n                  @dblclick="makeFolder">\n                  {{ item.name }}\n                  <span v-if="isFolder">[{{ isOpen ? "-" : "+" }}]</span>\n                  \n                </div>\n                <a\n                    v-if="!isBase"\n                    @click="$emit(\'edit-item\', item)" \n                    href="#"\n                    >\n                    Ред.\n                </a>\n                <a\n                    v-if="!isBase"\n                    @click="$emit(\'remove-item\', item)" \n                    href="#"\n                    >\n                    Удалить\n                </a>\n                \n                <ul v-show="isOpen" v-if="isFolder">\n                  <tree-item\n                    class="item"\n                    v-for="(child, index) in item.children"\n                    :key="index"\n                    :item="child"\n                    @make-folder="$emit(\'make-folder\', $event)"\n                    @add-item="$emit(\'add-item\', $event)"\n                    @edit-item="$emit(\'edit-item\', $event)"\n                    @remove-item="$emit(\'remove-item\', $event)"\n                  ></tree-item>\n                  <li class="add" @click="$emit(\'add-item\', item)">+</li>\n                </ul>\n            </li>',props:{item:Object},name:"tree-item",data:function(){return{isOpen:!0}},computed:{isFolder:function(){return this.item.children,this.item.children&&Object.keys(this.item.children).length},isBase:function(){return this.item.children&&this.item.is_base}},methods:{toggle:function(){this.isFolder&&(this.isOpen=!this.isOpen)},makeFolder:function(){this.isFolder||(this.$emit("make-folder",this.item),this.isOpen=!0)},editItem:function(){console.log("name"),this.$emit("edit-item",this.item)}}}},data:function(){return{IsEmptyTree:!0,group_nodes:{},pagination:{},remove_group_node_name:"",remove_group_node_id:0,param_group_node_id:null,isViewCreate:!0,formData:{},formCreateData:{name:"",description:"",group_node_id:null,store_id:0,id:0},create_errors:{},errors:{},treeData:{}}},computed:function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},(0,o.rn)({cur_store_name:function(e){return e.select_store_name},cur_store_id:function(e){return e.select_store_id}})),methods:{makeFolder:function(e){this.addItem(e)},addItem:function(e){this.formCreateData.group_node_id=e.id,this.showAddModal()},addItemForEmpty:function(){this.formCreateData.group_node_id=null,this.showAddModal()},removeItem:function(e){this.showRemoveModal(e.id,e.name)},editItem:function(e){this.param_group_node_id=e.id,console.log("id:"+this.param_group_node_id),this.showEditModal()},showEditModal:function(){this.isViewCreate=!1,this.getDetailGroupNode(),$(this.$refs.modal3).modal("show")},saveEditModal:function(){$(this.$refs.modal3).modal("hide"),this.sendData(),console.log("pre getGroupNodesThree")},showAddModal:function(){this.isViewCreate=!0,$(this.$refs.modal3).modal("show")},saveAddModal:function(){$(this.$refs.modal3).modal("hide"),this.sendData(),this.getGroupNodesThree()},getGroupNodesThree:function(){var e=this,t=localStorage.getItem("token");axios.defaults.headers.common.Authorization="Bearer "+t,axios.post("/api/get_group_node_three_list",{store_id:this.cur_store_id}).then((function(t){Object.keys(t.data.group_nodes).length>0?e.IsEmptyTree=!1:e.IsEmptyTree=!0;var a={id:null,name:"root",is_base:1,children:t.data.group_nodes};e.treeData=a})).catch((function(e){console.log(e)}))},getGroupNodes:function(e){var t=this,a=localStorage.getItem("token");axios.defaults.headers.common.Authorization="Bearer "+a,e=e||"api/get_group_node_list",axios.post(e,{store_id:this.cur_store_id}).then((function(e){console.log("group_nodes length:"+e.data.group_nodes.data.length),t.group_nodes=e.data.group_nodes.data,t.makePagination(e.data.group_nodes)})).catch((function(e){console.log(e)}))},makePagination:function(e){var t={current_page:e.current_page,last_page:e.last_page,prev_page_url:e.prev_page_url,next_page_url:e.next_page_url};this.pagination=t},showRemoveModal:function(e,t){this.remove_group_node_name=t,this.remove_group_node_id=e,$(this.$refs.modal2).modal("show")},removeGroupNode:function(){var e=this,t=localStorage.getItem("token");axios.defaults.headers.common.Authorization="Bearer "+t;var a={id:this.remove_group_node_id};axios.post("/api/remove_group_node",a).then((function(t){$(e.$refs.modal2).modal("hide"),e.getGroupNodesThree()})).catch((function(t){e.create_errors=t.response.data.errors}))},sendData:function(){this.isViewCreate?(console.log("sendCreateGroupNode"),this.sendCreateGroupNode()):(console.log("sendUpdateGroupNode"),this.sendEditGroupNode())},sendCreateGroupNode:function(){var e=this,t=localStorage.getItem("token");this.formCreateData.store_id=this.cur_store_id,axios.defaults.headers.common.Authorization="Bearer "+t,axios.post("/api/create_group_node",this.formCreateData).then((function(t){$(e.$refs.modal3).modal("hide"),e.resetFormCreate(),e.getGroupNodesThree()})).catch((function(t){e.create_errors=t.response.data.errors}))},sendEditGroupNode:function(){var e=this,t=localStorage.getItem("token");axios.defaults.headers.common.Authorization="Bearer "+t,this.formCreateData.id=this.param_group_node_id,axios.post("/api/update_group_node",this.formCreateData).then((function(t){$(e.$refs.modal3).modal("hide"),e.resetFormCreate(),e.getGroupNodesThree()})).catch((function(t){e.create_errors=t.response.data.errors}))},resetFormCreate:function(){this.formCreateData.group_node_id=null,this.formCreateData.id=0,this.formCreateData.store_id=0,this.formCreateData.name="",this.formCreateData.description=""},getDetailGroupNode:function(){var e=this,t=localStorage.getItem("token");axios.defaults.headers.common.Authorization="Bearer "+t,axios.post("/api/detail_group_node_info",{id:this.param_group_node_id,store_id:this.cur_store_id}).then((function(t){e.formCreateData.name=t.data.group_node.name,e.formCreateData.description=t.data.group_node.description,e.formCreateData.group_node_id=t.data.group_node.group_node_id})).catch((function(t){e.create_errors=t.response.data.errors}))}},mounted:function(){this.getGroupNodesThree()}};const n=(0,a(1900).Z)(s,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("h2",[e._v("Группа узла")]),e._v(" "),a("div",{ref:"modal2",staticClass:"modal fade",attrs:{id:"exampleModal2",tabindex:"-1","aria-labelledby":"exampleModalLabel2","aria-hidden":"true"}},[a("div",{staticClass:"modal-dialog modal-lg"},[a("div",{staticClass:"modal-content"},[e._m(0),e._v(" "),a("div",{staticClass:"modal-body"},[e._v("\n                    Вы уверены, что хотите удалить группу узла:"+e._s(e.remove_group_node_name)+"?\n                ")]),e._v(" "),a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:e.removeGroupNode}},[e._v("Удаление")])])])])]),e._v(" "),a("div",{ref:"modal3",staticClass:"modal fade",attrs:{id:"exampleModal3",tabindex:"-1","aria-labelledby":"exampleModalLabel3","aria-hidden":"true"}},[a("div",{staticClass:"modal-dialog modal-lg"},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-6"},[e.isViewCreate?a("h5",{staticClass:"modal-title",attrs:{id:"exampleModalLabel3"}},[e._v("Добавление группы узлов")]):e._e(),e._v(" "),e.isViewCreate?e._e():a("h5",{staticClass:"modal-title",attrs:{id:"exampleModalLabel3"}},[e._v('Редактируем группу узлов: "'+e._s(e.formCreateData.name)+'" ')])]),e._v(" "),e._m(1)])]),e._v(" "),a("div",{staticClass:"modal-body"},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"name"}},[e._v("Название")]),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.formCreateData.name,expression:"formCreateData.name"}],staticClass:"form-control",attrs:{type:"text",name:"name"},domProps:{value:e.formCreateData.name},on:{input:function(t){t.target.composing||e.$set(e.formCreateData,"name",t.target.value)}}}),e._v(" "),a("p",{staticClass:"text-danger",domProps:{textContent:e._s(e.create_errors.name)}})]),e._v(" "),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"description"}},[e._v("Описание")]),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.formCreateData.description,expression:"formCreateData.description"}],staticClass:"form-control",attrs:{type:"text",name:"description"},domProps:{value:e.formCreateData.description},on:{input:function(t){t.target.composing||e.$set(e.formCreateData,"description",t.target.value)}}}),e._v(" "),a("p",{staticClass:"text-danger",domProps:{textContent:e._s(e.create_errors.description)}})])]),e._v(" "),a("div",{staticClass:"modal-footer"},[e.isViewCreate?a("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:e.sendData}},[e._v("Добавить")]):e._e(),e._v(" "),e.isViewCreate?e._e():a("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:e.sendData}},[e._v("Редактировать")])])])])]),e._v(" "),a("ul",{attrs:{id:"demo"}},[a("tree-item",{staticClass:"item",attrs:{item:e.treeData},on:{"make-folder":e.makeFolder,"add-item":e.addItem,"edit-item":e.editItem,"remove-item":e.removeItem}})],1),e._v(" "),e.IsEmptyTree?a("div",[a("button",{on:{click:e.addItemForEmpty}},[e._v("Создать")])]):e._e()])}),[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"modal-header"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-6"},[a("h5",{staticClass:"modal-title",attrs:{id:"exampleModalLabel2"}},[e._v("Удаление группы узлов")])]),e._v(" "),a("div",{staticClass:"col-6"},[a("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[a("span",{attrs:{"aria-hidden":"true"}},[e._v("×")])])])])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"col-6"},[a("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[a("span",{attrs:{"aria-hidden":"true"}},[e._v("×")])])])}],!1,null,null,null).exports}}]);